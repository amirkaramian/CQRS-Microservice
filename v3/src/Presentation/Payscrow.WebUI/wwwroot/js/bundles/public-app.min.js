function Step(n,t,i,r){var u=this;u.id=n;u.name=ko.observable(t);u.template=i;r.isDone=ko.observable(!1);r.isPrestine=ko.observable(!0);r.validation=ko.validatedObservable(r);r.hasError=ko.pureComputed(function(){return!r.validation.isValid()&&!r.isPrestine()});r.nextButtonTitle;u.model=ko.observable(r);u.getTemplate=function(){return u.template}}var showModal=function(n){if(typeof n=="undefined")throw new Error("An options argument is required.");if(typeof n.viewModel!="object")throw new Error("options.viewModel is required.");var t=n.viewModel,i=n.template||t.template,r=n.context;return createModalElement(i,t).pipe(function(n){return $(n)}).pipe(function(n){var i=$.Deferred();return addModalHelperToViewModel(t,i,r),showTwitterBootstrapModal(n),whenModalResultCompleteThenHideUI(i,n),whenUIHiddenThenRemoveUI(n),i})},createModalElement=function(n,t){var r=addHiddenDivToBody(),i=$.Deferred();return t.hasErrors=ko.pureComputed(function(){return t.errors().length>0}),t.errors=ko.observableArray([]),t.errorStatusCode=ko.observable(),ko.renderTemplate(n,t,{afterRender:function(n){var t=n.filter(function(n){return n.nodeType===1});i.resolve(t[0])}},r,"replaceNode"),i},addHiddenDivToBody=function(){var n=document.createElement("div");return n.style.display="none",document.body.appendChild(n),n},addModalHelperToViewModel=function(n,t,i){n.modal={close:function(n){typeof n!="undefined"?t.resolveWith(i,[n]):t.rejectWith(i,[])}};n.executeQuery=function(n){return new Promise((t,i)=>{$.blockUI(),$.ajax({url:n,type:"get",success:function(n){t(n)},error:function(n){console.log(n);i(n)},complete:()=>{$.unblockUI()}})})};n.validationResult=ko.validatedObservable(n);n.executeCommand=function(t,i){return new Promise((r,u)=>{if(n.errors([]),!n.validationResult.isValid())return n.validationResult.errors.showAllMessages(),u("not valid inputs");$.blockUI();$.ajax({url:t,type:"post",contentType:"application/json",data:ko.toJSON(i),success:function(n){n.success?r(n):u(n)},error:function(t){for(let i in t.responseJSON.errors){let r=t.responseJSON.errors[i];r.message?n.errors.push(r.message):n.errors.push(r)}u(t)},complete:()=>{$.unblockUI()}})})};typeof n.init=="function"&&n.init()},showTwitterBootstrapModal=function(n){n.modal("show")},whenModalResultCompleteThenHideUI=function(n,t){n.always(function(){t.modal("hide")})},whenUIHiddenThenRemoveUI=function(n){n.on("hidden.bs.modal",function(){setTimeout(function(){n.each(function(n,t){ko.cleanNode(t)});n.remove()},500)})};ko.bindingHandlers.slideToggle={init:function(n,t){var i=t();$(n).toggle(ko.utils.unwrapObservable(i))},update:function(n,t){var i=t();ko.utils.unwrapObservable(i)?$(n).slideDown():$(n).slideUp()}};ko.bindingHandlers.number={update:function(n,t,i){var f=ko.bindingHandlers.number.defaults,e=i,r=ko.utils.unwrapObservable,o=r(t())||t(),s="",h,l=r(e().separator)||f.separator,a=r(e().decimal)||f.decimal,v=r(e().precision)||f.precision,c=r(e().symbol)||f.symbol,y=r(e().after)||f.after,u;for(o=parseFloat(o)||0,o=o.toFixed(v),h=o.toString().split("."),u=0;u<h.length;u++)s+=u==0?h[u].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+l):a+h[u];s=y?s+=c:c+" "+s;ko.bindingHandlers.text.update(n,function(){return s})},defaults:{separator:",",decimal:".",precision:0,symbol:"",after:!1}};ko.bindingHandlers.tooltip={init:function(n,t){var r=ko.utils.unwrapObservable(t()),i={};ko.utils.extend(i,ko.bindingHandlers.tooltip.options);ko.utils.extend(i,r);i.template='<div class="tooltip tooltip-brand tooltop-auto-width" role="tooltip">                <div class="arrow"><\/div>                <div class="tooltip-inner"><\/div>            <\/div>';$(n).tooltip(i);ko.utils.domNodeDisposal.addDisposeCallback(n,function(){$(n).tooltip("dispose")})},options:{placement:"right",trigger:"click"}};ko.bindingHandlers.timeByHourMinute={init:function(n,t){var i=moment(ko.utils.unwrapObservable(t())).format("HH : mm");ko.utils.setTextContent(n,i)}};ko.extenders.numeric=function(n,t){var i=ko.computed({read:function(){return!isNaN(parseFloat(n()))&&isFinite(n())?parseFloat(n()).toFixed(t).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):n()},write:n});return i.raw=n,i};ko.bindingHandlers.select2={after:["options","value"],init:function(n,t){$(n).select2(ko.unwrap(t()));ko.utils.domNodeDisposal.addDisposeCallback(n,function(){$(n).select2("destroy")})},update:function(n,t,i){var u=i(),f=$(n).data("select2"),r;"value"in u&&(r=""+ko.unwrap(u.value),(u.select2.multiple||n.multiple)&&r.constructor!==Array?f.val([r.split(",")]):f.val([r]))}};ko.bindingHandlers.tooltipster={init:function(n,t){$(n).tooltipster(ko.unwrap(t()))}};ko.bindingHandlers.datepicker={init:function(n,t,i){var r=$(n),u=$.extend({todayHighlight:!0,format:"dd/mm/yyyy",orientation:"bottom left",autoclose:!0,templates:{leftArrow:'<i class="la la-angle-left"><\/i>',rightArrow:'<i class="la la-angle-right"><\/i>'}},i().datePickerOptions||{});r.datepicker(u);ko.utils.registerEventHandler(n,"changeDate",function(n){var i=t();ko.isObservable(i)&&i(moment(n.date,"LLLL").format("DD/MM/YYYY"))});ko.utils.domNodeDisposal.addDisposeCallback(n,function(){r.datepicker("destroy")})},update:function(n,t){var i=$(n).data("datepicker");i&&(i.date=ko.utils.unwrapObservable(t()),i.date&&i.setValue())}};ko.bindingHandlers.dateFormater={update:function(n,t,i){var r=ko.utils.unwrapObservable(t()),f,u;moment(r).isValid()&&(f=i(),u=f.dateOptions||{},u.locale?ko.utils.setTextContent(n,moment(r).locale(u.locale).format("DD/MM/YYYY")):ko.utils.setTextContent(n,moment(r).format("DD/MM/YYYY")))}};ko.bindingHandlers.widgetDateFormater={update:function(n,t,i){var r=ko.utils.unwrapObservable(t()),u,f;moment(r).isValid()?(u=i(),f=u.dateOptions||{},ko.utils.setTextContent(n,moment(r).format("DD MMM, YY"))):ko.utils.setTextContent(n,"N/A")}};ko.bindingHandlers.daterangePicker={init:function(n,t){$(n).daterangepicker({autoApply:!0,startDate:moment().add(-30,"days"),endDate:moment(),ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}});ko.utils.registerEventHandler(n,"change",function(){var i=$(n).data("daterangepicker"),r=t();r([i.startDate.format("YYYY-MM-DD"),i.endDate.format("YYYY-MM-DD")])})},update:function(n,t){var i=$(n).data("daterangepicker"),r=t();r([i.startDate.format("YYYY-MM-DD"),i.endDate.format("YYYY-MM-DD")])}};ko.bindingHandlers.touchSpin={init:function(n,t,i){var u=t(),f=i(),e=ko.utils.unwrapObservable(t()),o=f.touchSpinOptions||{},s=ko.bindingHandlers.touchSpin.defaults,r=$(n),h=$.extend({initval:e},s,o);r.TouchSpin(h);u(r.val());r.on("touchspin.on.startspin",function(){u(r.val())})},update:function(n,t,i){var r=i();ko.bindingHandlers.value.update(n,t)},updateEnableState:function(n,t){var u=$(n),i=u.parent().find(".bootstrap-touchspin-up"),r=u.parent().find(".bootstrap-touchspin-down");t.enable!==undefined&&(ko.utils.unwrapObservable(t.enable)===!0?(i.removeAttr("disabled"),r.removeAttr("disabled")):(i.attr("disabled","disabled"),r.attr("disabled","disabled")));t.disable!==undefined&&(ko.utils.unwrapObservable(t.disable)===!1?(i.removeAttr("disabled"),r.removeAttr("disabled")):(i.attr("disabled","disabled"),r.attr("disabled","disabled")))},defaults:{min:0,max:100,initval:1,step:1,decimals:0,stepinterval:100,forcestepdivisibility:"round",stepintervaldelay:500,prefix:"",postfix:"",prefix_extraclass:"",postfix_extraclass:"",booster:!0,boostat:10,maxboostedstep:!1,mousewheel:!1,buttondown_class:"btn btn-default",buttonup_class:"btn btn-default"}};ko.bindingHandlers.dropzone={init:function(n,t){var u=ko.unwrap(t()),i={maxFileSize:15,removeFileOnSuccess:!0},r;$.extend(i,u);$(n).addClass("dropzone");r=new Dropzone(n,i);r.on("success",function(n){i.removeFileOnSuccess&&r.removeFile(n)})}};ko.bindingHandlers.trimLengthText={};ko.bindingHandlers.trimText={init:function(n,t,i,r){var u=ko.computed(function(){var n=ko.utils.unwrapObservable(t()),u=5,r=ko.utils.unwrapObservable(i().trimTextLength)||20;return r<u&&(r=u),n!=null?n.length>r?n.substring(0,r-1)+"...":n:""});return ko.applyBindingsToNode(n,{text:u},r),{controlsDescendantBindings:!0}}};ko.bindingHandlers.valueNumber={init:function(n,t,i){function c(){var r=!1,t=n.ownerDocument,i;if("activeElement"in t){try{i=t.activeElement}catch(u){i=t.body}r=i===n}return r}function u(n){e(n)}var r=t(),f=i(),e=ko.observable(c()),o=u.bind(null,!0),s=u.bind(null,!1),h=ko.computed({read:function(){var n=ko.utils.unwrapObservable(r),t,i;return e()?!isNaN(n)&&n!==null&&n!==undefined?n.toString().replace(".",Globalize.findClosestCulture().numberFormat["."]):null:(t=f.numberFormat||"n2",i=Globalize.numberFormatter(n,t),i)},write:function(n){var i=ko.utils.unwrapObservable(r),t=Globalize.parseFloat(n);isNaN(t)?n.length===0&&(f.isNullable?r(null):r(0)):t!==i&&r(t)}});ko.utils.registerEventHandler(n,"focus",o);ko.utils.registerEventHandler(n,"focusin",o);ko.utils.registerEventHandler(n,"blur",s);ko.utils.registerEventHandler(n,"focusout",s);n.tagName.toLowerCase()==="input"?ko.applyBindingsToNode(n,{value:h}):ko.applyBindingsToNode(n,{text:h})}};ko.validation.rules.atLeastOne={validator:function(n,t){return t&&Array.isArray(n)?!!n.length:!0},message:"Please add at least one."};ko.validation.rules.isLargerThan={validator:function(n,t){return t=t(),parseFloat(n)>parseFloat(t)},message:"This need to be larger than the First Number "};ko.validation.rules.isLessThan={validator:function(n,t){return parseFloat(n)<parseFloat(t)},message:"This need to be larger than the First Number "};ko.validation.rules.isLessThanOrEqual={validator:function(n,t){return parseFloat(n)<=parseFloat(t)},message:"This need to be larger than or equal the First Number "};ko.validation.rules.areSame={getValue:function(n){return typeof n=="function"?n():n},validator:function(n,t){return n===this.getValue(t)},message:"The fields must have the same value"};ko.validation.rules.mustNotEqual={validator:function(n,t){return n!==t},message:"The field must equal {0}"};ko.validation.init({decorateInputElement:!0,errorElementClass:"is-invalid",errorMessageClass:"invalid-feedback",insertMessages:!0,grouping:{deep:!0,observable:!0,live:!0}});ko.validation.registerExtenders();$.blockUI.defaults.message=$("#custom-loader");$.blockUI.defaults.css.border="none";$.blockUI.defaults.css.background="none";$.blockUI.defaults.baseZ=1051;$(document).ajaxSend(function(){ko.postbox.publish("isLoading",!0)});$(document).ajaxStop(function(){ko.postbox.publish("isLoading",!1)});$.ajaxSetup({statusCode:{401:function(){window.location.reload()}}});var AddOrEditItemViewModel=function(n){var t=this;t.template="add_edit_item_tmpl";t.model={name:ko.observable().extend({required:!0}),description:ko.observable().extend({required:!0}),amount:ko.observable().extend({required:!0,number:!0}),availableQuantity:ko.observable().extend({required:!0,number:!0}),isTangible:ko.observable(!0)};n&&(t.model.name(n.name),t.model.description(n.description),t.model.amount(n.amount),t.model.availableQuantity(n.availableQuantity));t.validationResult=ko.validatedObservable(t.model);t.addToList=function(){if(!t.validationResult.isValid())return t.validationResult.errors.showAllMessages(),!1;t.modal.close(ko.toJS(t.model))}},DealDetailStep=function(){var n=this;n.loading=ko.observable().subscribeTo("isLoading");n.currencies=ko.observableArray([]);n.chargeConfigList=ko.observableArray([{value:100,text:"I will pay"},{value:75,text:"I will pay 75%"},{value:25,text:"I will pay 25%"},{value:0,text:"Buyer pays"}]);n.sellerEmail=ko.observable().extend({required:!0,email:!0}).publishOn("sellerEmail");n.sellerPhone=ko.observable().extend({required:!0,digit:!0}).publishOn("sellerPhone");n.currencyCode=ko.observable().extend({required:!0}).publishOn("currencyCode");n.sellerChargePercentage=ko.observable().extend({required:!0}).publishOn("sellerChargePercentage");n.buyerUrl=ko.observable().publishOn("buyerUrl");n.title=ko.observable().extend({required:!0}).publishOn("title");n.description=ko.observable().publishOn("description");n.isAuthenticated=ko.observable(!1).publishOn("isAuthenticated");n.init=function(){n.loading(!0);$.blockUI();$.ajax({url:"/api/v3/PaymentInviteDeals/create-deal-data",type:"get",success:function(t){console.log(t);n.isAuthenticated(t.isAuthenticated);n.currencies(t.currencies);n.buyerUrl(t.buyerPageUrl);t.email&&n.sellerEmail(t.email);t.phone&&n.sellerPhone(t.phone)},error:function(n){console.log(n)},complete:function(){n.loading(!1);$.unblockUI()}})};n.init()},DealItemsStep=function(){var n=this;n.currencyCode=ko.observable().subscribeTo("currencyCode");n.items=ko.observableArray([]).extend({atLeastOne:{message:"Please add at least one item."}}).publishOn("dealItems");n.addItem=function(){var t=new AddOrEditItemViewModel;showModal({viewModel:t,context:n}).then(t=>{n.items.push(t)})};n.editItem=function(t){var i=new AddOrEditItemViewModel(t);showModal({viewModel:i,context:n}).then(()=>{})};n.deleteItem=function(t){n.items.remove(t)}},SummaryStep=function(){var n=this;n.command={sellerEmail:ko.observable().subscribeTo("sellerEmail"),sellerLocalPhoneNumber:ko.observable().subscribeTo("sellerPhone"),currencyCode:ko.observable().subscribeTo("currencyCode"),sellerChargePercentage:ko.observable().subscribeTo("sellerChargePercentage"),items:ko.observableArray().subscribeTo("dealItems"),buyerUrl:ko.observable().subscribeTo("buyerUrl"),title:ko.observable().subscribeTo("title"),description:ko.observable().subscribeTo("description")}},VerificationAndCompletionStep=function(){var n=this;n.isAuthenticated=ko.observable().subscribeTo("isAuthenticated");n.isVerified=ko.observable(!1);n.command={dealId:ko.observable().subscribeTo("dealId"),code:ko.observable().extend({required:!0})};n.validationResult=ko.validatedObservable(n.command);n.verifyCode=function(){if(!n.validationResult.isValid())return n.validationResult.errors.showAllMessages(),!1;$.blockUI();$.ajax({url:"/api/v3/PaymentInviteDeals/verify-deal",type:"post",contentType:"application/json",data:ko.toJSON(n.command),success:function(n){console.log(n);n.errors.length==0&&swal({title:"Deal Creation Successful?",text:"You have successfully created and verified your sales deal.",type:"success"}).then(function(){window.location.href="/"})},error:function(n){console.log(n)},complete:function(){$.unblockUI()}})}},CreateDealViewModel=function(){var n=this;n.loading=ko.observable().subscribeTo("isLoading");n.hasError=ko.observable(!1);n.errors=ko.observableArray([]);var i=new DealDetailStep,r=new DealItemsStep,t=new SummaryStep,u=new VerificationAndCompletionStep;n.stepModels=ko.observableArray([new Step(1,"Deal Details","deal_details_tmpl",i),new Step(2,"Deal Items","deal_items_tmpl",r),new Step(3,"Summary","deal_summary_tmpl",t),new Step(4,"Completion","verification_tmpl",u),]);n.createdDealId=ko.observable().publishOn("dealId");n.createDeal=function(){$.blockUI();$.ajax({url:"/api/v3/PaymentInviteDeals/create-deal",type:"post",contentType:"application/json",data:ko.toJSON(t.command),success:function(t){t.success&&(n.createdDealId(t.dealId),t.isVerified?alert("Deal Created Successfully!"):n.goNext())},error:function(n){console.log(n)},complete:function(){$.unblockUI()}})};n.getState=function(t){return n.currentIndex()==t?"current":n.stepModels()[t].model().isDone()?"done":""};n.isModelDone=function(t){return n.stepModels()[t].model().isDone()};n.currentStep=ko.observable(n.stepModels()[0]);n.currentIndex=ko.dependentObservable(function(){return n.stepModels.indexOf(n.currentStep())});n.getTemplate=function(){return n.currentStep().template()};n.canGoNext=ko.dependentObservable(function(){return n.currentIndex()<n.stepModels().length-1});n.goNext=function(){if(n.validateStep=ko.validatedObservable(n.stepModels()[n.currentIndex()]),n.canGoNext()){if(!n.validateStep.isValid())return n.validateStep.errors.showAllMessages(),n.stepModels()[n.currentIndex()].model().isPrestine&&n.stepModels()[n.currentIndex()].model().isPrestine(!1),!1;$.isFunction(n.stepModels()[n.currentIndex()+1].model().initialize)&&n.stepModels()[n.currentIndex()+1].model().initialize();n.stepModels()[n.currentIndex()].model().isDone(!0);n.currentStep(n.stepModels()[n.currentIndex()+1])}};n.canGoPrevious=ko.dependentObservable(function(){return n.currentIndex()>0});n.goPrevious=function(){n.canGoPrevious()&&n.currentStep(n.stepModels()[n.currentIndex()-1])}},TransactionDetailStep=function(n){var t=this,i;t.currencyCode=ko.observable().publishOn("currencyCode");t.items=ko.observableArray([]).extend({atLeastOne:{message:"Please add at least one item."}}).publishOn("transactionItems");t.subTotal=ko.computed(()=>{var n=0;return ko.utils.arrayForEach(t.items(),t=>{n+=t.total()}),n});t.buyerCharges=ko.observable(0);t.grandTotal=ko.pureComputed(()=>t.subTotal()+t.buyerCharges());i=function(){$.blockUI();$.ajax({url:"/api/v3/paymentinvitetransactions/create-transaction-data?dealId="+n,type:"get",success:function(n){t.currencyCode(n.currencyCode);t.buyerCharges(n.buyerTransactionCharge);console.log(n);ko.utils.arrayForEach(n.items,function(n){n.quantity>0&&t.items.push(function(){var t=this;return t.description=n.description,t.name=n.name,t.quantity=ko.observable(n.quantity),t.amount=ko.observable(n.amount),t.total=ko.computed(()=>t.quantity()*t.amount()),{description:t.description,name:t.name,quantity:t.quantity,amount:t.amount,total:t.total}}())})},error:n=>{console.log(n)},complete:()=>{$.unblockUI()}})};i()},BuyerInfoStep=function(n){var t=this;t.command={dealId:n,buyerEmail:ko.observable().extend({required:!0,email:!0}),buyerPhone:ko.observable().extend({required:!0})}},PaymentMethodsStep=function(){var n=this;n.currencyCode=ko.observable().subscribeTo("currencyCode");n.methods=ko.observableArray([]);n.paymentId=ko.observable().subscribeTo("paymentId");n.initialize=function(){$.blockUI();$.ajax({url:"/api/v3/Payments/payment-methods?currencyCode="+n.currencyCode(),type:"get",success:function(t){n.methods(t.paymentMethods)},error:n=>{console.log(n)},complete:()=>{$.unblockUI()}})};n.getPaymentLink=function(t){$.blockUI();$.ajax({url:"/api/v3/payments/payment-link",type:"post",contentType:"application/json",data:ko.toJSON({paymentId:n.paymentId(),paymentMethodId:t.id}),success:n=>{console.log(n),window.location.href=n.link},error:n=>{console.log(n)},complete:()=>{$.unblockUI()}})}},CreateTransactionViewModel=function(n){var t=this;t.loading=ko.observable().subscribeTo("isLoading");t.hasError=ko.observable(!1);t.errors=ko.observableArray([]);var r=new TransactionDetailStep(n),i=new BuyerInfoStep(n),u=new PaymentMethodsStep;t.stepModels=ko.observableArray([new Step(1,"Transaction Details","transaction_items_tmpl",r),new Step(2,"Personal Info","buyer_info_tmpl",i),new Step(3,"Payment Methods","payment_methods_tmpl",u)]);t.transactionId=ko.observable().publishOn("transactionId");t.paymentId=ko.observable().publishOn("paymentId");t.createTransaction=function(){var n=ko.validatedObservable(i.command);if(!n.isValid()){n.errors.showAllMessages();return}$.blockUI();$.ajax({url:"/api/v3/PaymentInvitetransactions/create-transaction",type:"post",contentType:"application/json",data:ko.toJSON(i.command),success:n=>{n.success&&(t.transactionId(n.transactionId),t.paymentId(n.paymentId),console.log(n),t.goNext())},error:n=>{console.log(n)},complete:()=>{$.unblockUI()}})};t.getState=function(n){return t.currentIndex()==n?"current":t.stepModels()[n].model().isDone()?"done":""};t.isModelDone=function(n){return t.stepModels()[n].model().isDone()};t.currentStep=ko.observable(t.stepModels()[0]);t.currentIndex=ko.dependentObservable(function(){return t.stepModels.indexOf(t.currentStep())});t.getTemplate=function(){return t.currentStep().template()};t.canGoNext=ko.dependentObservable(function(){return t.currentIndex()<t.stepModels().length-1});t.goNext=function(){if(t.validateStep=ko.validatedObservable(t.stepModels()[t.currentIndex()]),t.canGoNext()){if(!t.validateStep.isValid())return t.validateStep.errors.showAllMessages(),t.stepModels()[t.currentIndex()].model().isPrestine&&t.stepModels()[t.currentIndex()].model().isPrestine(!1),!1;$.isFunction(t.stepModels()[t.currentIndex()+1].model().initialize)&&t.stepModels()[t.currentIndex()+1].model().initialize();t.stepModels()[t.currentIndex()].model().isDone(!0);t.currentStep(t.stepModels()[t.currentIndex()+1])}};t.canGoPrevious=ko.dependentObservable(function(){return t.currentIndex()>0&&t.currentIndex()<2});t.goPrevious=function(){t.canGoPrevious()&&t.currentStep(t.stepModels()[t.currentIndex()-1])}},PaymentVerificationViewModel=function(n,t,i,r){function u(){r!="successful"?alert("payment unsuccessful!"):($.blockUI(),$.ajax({url:"/api/v3/payments/verify-payment",type:"post",contentType:"application/json",data:ko.toJSON({paymentMethodId:n,paymentId:t,externalTransactionId:i,status:r}),success:n=>{console.log(n),n.isVerified&&alert("Your payment is Now Complete")},error:n=>{console.log(n)},complete:()=>{$.unblockUI()}}))}var f=this;u()},AuthenticateCustomerViewModel=function(){var n=this},PaymentDetailsStep=function(n){var t=this;t.hasPaymentId=ko.observable(!1);t.paymentMethodList=ko.observableArray([]);t.currencyCode=ko.observable().subscribeTo("currencyCode");t.brokerAccountId=ko.observable().subscribeTo("brokerAccountId");t.paymentId=ko.observable().subscribeTo("paymentId");t.getPaymentLink=function(n){$.blockUI();$.ajax({url:"/api/v3/payments/payment-link",type:"post",contentType:"application/json",data:ko.toJSON({paymentId:t.paymentId(),paymentMethodId:n.id}),success:n=>{console.log(n),window.location.href=n.link},error:n=>{console.log(n)},complete:()=>{$.unblockUI()}})};t.init=function(){t.paymentMethodList().length==0&&($.blockUI(),$.ajax({url:"/api/v3/Payments/payment-methods?currencyCode="+t.currencyCode(),type:"get",success:n=>{t.paymentMethodList(n.paymentMethods),console.log(ko.toJS(t.paymentMethodList))},complete:()=>{$.unblockUI()}}));t.hasPaymentId()||$.ajax({url:"/api/v3/marketplace/transactions/"+n+"/paymentid",type:"get",success:n=>{console.log(n),n.success&&(t.paymentId(n.paymentId),t.hasPaymentId(!0))},error:n=>{console.log(n)}})}},TransactionDetailsStep=function(n){function i(){$.blockUI();$.ajax({url:"/api/v3/marketplace/transactions/pending/"+n,type:"get",success:n=>{ko.mapping.fromJS(n,{},t.model),console.log(ko.toJS(t.model))},error:n=>{console.log(n)},complete:()=>{$.unblockUI()}})}var t=this;t.model={transaction:{id:ko.observable(),number:ko.observable(),brokerAccountId:ko.observable().publishOn("brokerAccountId"),brokerName:ko.observable(),merchantName:ko.observable(),merchantEmailAddress:ko.observable(),customerAccountId:ko.observable().publishOn("customerAccountId"),customerName:ko.observable().publishOn("customerName"),customerEmailAddress:ko.observable().publishOn("customerEmailAddress"),customerCharge:ko.observable(),grandTotalPayable:ko.observable(),currencyCode:ko.observable().publishOn("currencyCode"),status:{displayName:ko.observable()}},items:ko.observableArray()};t.total=ko.pureComputed(function(){return parseFloat(t.model.transaction.grandTotalPayable())-parseFloat(t.model.transaction.customerCharge())},t);i()},CustomerAcceptTransactionViewModel=function(n){var t=this,i=new TransactionDetailsStep(n),r=new PaymentDetailsStep(n);t.stepModels=ko.observableArray([new Step(1,"Transaction Details","transaction_details_tmpl",i),new Step(2,"Payment Initiation","payment_tmpl",r)]);t.proceedToPay=function(){t.goNext()};t.getState=function(n){return t.currentIndex()==n?"current":t.stepModels()[n].model().isDone()?"done":""};t.currentStep=ko.observable(t.stepModels()[0]);t.currentIndex=ko.dependentObservable(function(){return t.stepModels.indexOf(t.currentStep())});t.getTemplate=function(){return t.currentStep().template()};t.canGoNext=ko.dependentObservable(function(){return t.currentIndex()<t.stepModels().length-1});t.goNext=function(){if(t.validateStep=ko.validatedObservable(t.stepModels()[t.currentIndex()]),!t.validateStep.isValid())return t.validateStep.errors.showAllMessages(),t.stepModels()[t.currentIndex()].model().isPrestine&&t.stepModels()[t.currentIndex()].model().isPrestine(!1),!1;$.isFunction(t.stepModels()[t.currentIndex()+1].model().init)&&t.stepModels()[t.currentIndex()+1].model().init();t.canGoNext()&&t.currentStep(t.stepModels()[t.currentIndex()+1])};t.canGoPrevious=ko.dependentObservable(function(){return t.currentIndex()>0});t.goPrevious=function(){t.canGoPrevious()&&t.currentStep(t.stepModels()[t.currentIndex()-1])}};